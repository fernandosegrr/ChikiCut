@page
@model ChikiCut.web.Pages.Roles.IndexModel
@{
    ViewData["Title"] = "Gestión de Roles";
}

<div class="page-header mb-4">
    <div class="row align-items-center">
        <div class="col">
            <h1><i class="bi bi-shield-check me-2"></i>Gestión de Roles</h1>
            <p class="text-muted">Administra los roles y permisos del sistema</p>
        </div>
        <div class="col-auto">
            @if (Model.CanCreateRoles)
            {
                <a asp-page="Create" class="btn btn-success">
                    <i class="bi bi-plus-lg me-1"></i>Nuevo Rol
                </a>
            }
            else
            {
                <button type="button" class="btn btn-success" disabled title="Solo administradores pueden crear roles">
                    <i class="bi bi-plus-lg me-1"></i>Nuevo Rol
                </button>
            }
        </div>
    </div>
</div>

<!-- Estadísticas rápidas -->
<div class="row g-3 mb-4">
    <div class="col-md-4">
        <div class="card border-primary">
            <div class="card-body text-center">
                <i class="bi bi-shield-check display-6 text-primary"></i>
                <h3 class="mt-2">@Model.TotalRoles</h3>
                <p class="text-muted mb-0">Total de Roles</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-success">
            <div class="card-body text-center">
                <i class="bi bi-shield-check-fill display-6 text-success"></i>
                <h3 class="mt-2">@Model.RolesActivos</h3>
                <p class="text-muted mb-0">Roles Activos</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-info">
            <div class="card-body text-center">
                <i class="bi bi-people-fill display-6 text-info"></i>
                <h3 class="mt-2">@Model.Roles.Sum(r => r.CantidadUsuarios)</h3>
                <p class="text-muted mb-0">Usuarios Asignados</p>
            </div>
        </div>
    </div>
</div>

<!-- Filtros de búsqueda -->
<div class="card mb-4">
    <div class="card-header">
        <i class="bi bi-funnel me-2"></i><strong>Filtros de Búsqueda</strong>
    </div>
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-6">
                <label for="busquedaNombre" class="form-label">Buscar por nombre</label>
                <input type="text" class="form-control" id="busquedaNombre" name="busquedaNombre" 
                       value="@Model.BusquedaNombre" placeholder="Nombre o descripción...">
            </div>
            <div class="col-md-4">
                <label for="filtroActivo" class="form-label">Estado</label>
                <select class="form-select" id="filtroActivo" name="filtroActivo">
                    <option value="">Todos los estados</option>
                    <option value="true" selected="@(Model.FiltroActivo == true)">Solo activos</option>
                    <option value="false" selected="@(Model.FiltroActivo == false)">Solo inactivos</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">&nbsp;</label>
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-search me-1"></i>Filtrar
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Lista de roles -->
<div class="card">
    <div class="card-header">
        <i class="bi bi-list-ul me-2"></i><strong>Roles del Sistema</strong>
    </div>
    <div class="card-body p-0">
        @if (Model.Roles.Any())
        {
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Rol</th>
                            <th>Usuarios</th>
                            <th>Permisos Activos</th>
                            <th>Estado</th>
                            <th>Creado</th>
                            <th class="text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var rol in Model.Roles)
                        {
                            <tr>
                                <td>
                                    <div>
                                        <strong>@rol.Nombre</strong>
                                        @if (!string.IsNullOrEmpty(rol.Descripcion))
                                        {
                                            <br><small class="text-muted">@rol.Descripcion</small>
                                        }
                                    </div>
                                </td>
                                <td>
                                    @if (rol.CantidadUsuarios > 0)
                                    {
                                        <span class="badge bg-primary">@rol.CantidadUsuarios usuario(s)</span>
                                    }
                                    else
                                    {
                                        <span class="text-muted">Sin usuarios</span>
                                    }
                                </td>
                                <td>
                                    <small class="text-muted">@rol.PermisosResumen</small>
                                </td>
                                <td>
                                    @if (rol.IsActive)
                                    {
                                        <span class="badge bg-success">Activo</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-secondary">Inactivo</span>
                                    }
                                </td>
                                <td>
                                    <small class="text-muted">@rol.CreatedAt.ToString("dd/MM/yyyy")</small>
                                </td>
                                <td class="text-center">
                                    <div class="btn-group btn-group-sm" role="group">
                                        <a asp-page="Details" asp-route-id="@rol.Id" 
                                           class="btn btn-outline-info" title="Ver detalles">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                        <a asp-page="Edit" asp-route-id="@rol.Id" 
                                           class="btn btn-outline-primary" title="Editar">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <a asp-page="Delete" asp-route-id="@rol.Id" 
                                           class="btn btn-outline-danger" title="Gestionar estado">
                                            <i class="bi bi-gear"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="text-center py-5">
                <i class="bi bi-shield-x display-1 text-muted"></i>
                <h4 class="mt-3">No se encontraron roles</h4>
                <p class="text-muted">
                    @if (!string.IsNullOrEmpty(Model.BusquedaNombre) || Model.FiltroNivel.HasValue || Model.FiltroActivo.HasValue)
                    {
                        <span>No hay roles que coincidan con los filtros aplicados.</span>
                    }
                    else
                    {
                        <span>Comienza creando el primer rol del sistema.</span>
                    }
                </p>
                <a asp-page="Create" class="btn btn-success">
                    <i class="bi bi-plus-lg me-1"></i>Crear Primer Rol
                </a>
            </div>
        }
    </div>
</div>

<!-- Información de ayuda -->
<div class="row mt-4">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-info-circle me-2"></i><strong>Sistema de Permisos</strong>
            </div>
            <div class="card-body">
                <h6>Características del Sistema:</h6>
                <ul class="small">
                    <li><strong>Permisos Granulares:</strong> Control específico por módulo y acción</li>
                    <li><strong>Plantillas Dinámicas:</strong> Configuraciones predefinidas reutilizables</li>
                    <li><strong>Flexibilidad Total:</strong> Personalización completa de permisos</li>
                    <li><strong>Seguridad:</strong> Validaciones automáticas y control de acceso</li>
                    <li><strong>Escalabilidad:</strong> Adaptable a cualquier estructura organizacional</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-lightbulb me-2"></i><strong>Buenas Prácticas</strong>
            </div>
            <div class="card-body">
                <ul class="small">
                    <li>Usa plantillas como punto de partida y personaliza según necesidades</li>
                    <li>Asigna solo los permisos mínimos necesarios para cada función</li>
                    <li>Revisa periódicamente los permisos de cada rol</li>
                    <li>Documenta claramente la función y responsabilidades de cada rol</li>
                    <li>Mantén al menos un rol con permisos administrativos completos</li>
                    <li>Comunica los cambios de permisos a los usuarios afectados</li>
                </ul>
            </div>
        </div>
    </div>
</div>