@page
@model ChikiCut.web.Pages.Puestos.DeleteModel
@{
    ViewData["Title"] = "Gestionar Puesto";
    var isDesactivar = Model.TipoOperacion == "desactivar";
    var actionText = isDesactivar ? "Desactivar" : "Reactivar";
    var buttonClass = isDesactivar ? "btn-warning" : "btn-success";
    var iconClass = isDesactivar ? "bi-x-circle" : "bi-check-circle";
}

<div class="page-header mb-4">
    <h1><i class="@iconClass me-2"></i>@actionText Puesto</h1>
    <p class="text-muted">
        @if (isDesactivar)
        {
            <span>¿Está seguro de que desea desactivar este puesto?</span>
        }
        else
        {
            <span>¿Está seguro de que desea reactivar este puesto?</span>
        }
    </p>
</div>

<!-- Información del puesto -->
<div class="card mb-4">
    <div class="card-header">
        <i class="bi bi-person-workspace me-2"></i><strong>Información del Puesto</strong>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <dl class="row">
                    <dt class="col-sm-5">Nombre:</dt>
                    <dd class="col-sm-7">@Model.Puesto.Nombre</dd>
                    <dt class="col-sm-5">Nivel:</dt>
                    <dd class="col-sm-7">
                        <span class="badge @(Model.Puesto.NivelJerarquico switch 
                        {
                            1 => "bg-secondary",
                            2 => "bg-primary", 
                            3 => "bg-info",
                            4 => "bg-warning",
                            _ => "bg-dark"
                        })">
                            @Model.Puesto.NivelDescripcion
                        </span>
                    </dd>
                    <dt class="col-sm-5">Estado Actual:</dt>
                    <dd class="col-sm-7">
                        <span class="badge @(Model.Puesto.IsActive ? "bg-success" : "bg-danger")">
                            @(Model.Puesto.IsActive ? "Activo" : "Inactivo")
                        </span>
                    </dd>
                </dl>
            </div>
            <div class="col-md-6">
                <dl class="row">
                    <dt class="col-sm-5">Rango Salarial:</dt>
                    <dd class="col-sm-7">@Model.Puesto.RangoSalarial</dd>
                    <dt class="col-sm-5">Empleados Asignados:</dt>
                    <dd class="col-sm-7">
                        <span class="badge bg-info">@Model.EmpleadosAsignados</span>
                    </dd>
                    <dt class="col-sm-5">Requiere Experiencia:</dt>
                    <dd class="col-sm-7">
                        @if (Model.Puesto.RequiereExperiencia)
                        {
                            <span class="badge bg-warning">Sí</span>
                        }
                        else
                        {
                            <span class="badge bg-secondary">No</span>
                        }
                    </dd>
                </dl>
            </div>
        </div>
        @if (!string.IsNullOrEmpty(Model.Puesto.Descripcion))
        {
            <hr>
            <h6>Descripción:</h6>
            <p class="text-muted">@Model.Puesto.Descripcion</p>
        }
    </div>
</div>

<!-- Mensajes y acciones -->
@if (Model.TieneRelaciones)
{
    <div class="alert alert-danger" role="alert">
        <i class="bi bi-exclamation-triangle me-2"></i>
        <strong>No se puede realizar la operación:</strong> @Model.MensajeRelaciones
    </div>
    
    <div class="card">
        <div class="card-header">
            <i class="bi bi-people me-2"></i><strong>Empleados que deben ser reasignados</strong>
        </div>
        <div class="card-body">
            <p>Para desactivar este puesto, primero debe:</p>
            <ol>
                <li>Reasignar los empleados a otros puestos activos, o</li>
                <li>Desactivar a los empleados que tienen este puesto asignado</li>
            </ol>
            <a href="/Empleados" class="btn btn-primary">
                <i class="bi bi-people me-1"></i>Ir a Gestión de Empleados
            </a>
        </div>
    </div>
}

<form method="post" class="mt-4">
    <input type="hidden" asp-for="Puesto.Id" />
    
    @if (!Model.TieneRelaciones)
    {
        @if (isDesactivar)
        {
            <div class="alert alert-warning" role="alert">
                <i class="bi bi-info-circle me-2"></i>
                <strong>Información:</strong> El puesto será desactivado pero sus datos se conservarán en el sistema. 
                No estará disponible para asignar a nuevos empleados.
            </div>
        }
        else
        {
            <div class="alert alert-info" role="alert">
                <i class="bi bi-info-circle me-2"></i>
                <strong>Información:</strong> El puesto será reactivado y estará disponible para asignar a empleados.
            </div>
        }
        
        <button type="submit" class="btn @buttonClass">
            <i class="@iconClass me-1"></i>Sí, @actionText Puesto
        </button>
    }
    
    <a asp-page="Index" class="btn btn-secondary @(Model.TieneRelaciones ? "ms-0" : "ms-2")">
        <i class="bi bi-arrow-left me-1"></i>Cancelar
    </a>
</form>